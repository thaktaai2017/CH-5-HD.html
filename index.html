<html>
<head>
    <title>WANDERING OLDMAN AIS</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="/clap.css">
    <script src="//cdn.jsdelivr.net/npm/@clappr/player@0.4.0/dist/clappr.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/mux.js@5.6.7/dist/mux.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/level-selector@latest/dist/level-selector.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/clappr-chromecast-plugin@latest/dist/clappr-chromecast-plugin.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/clappr-pip@latest/dist/clappr-pip.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/clappr-playback-rate-plugin@latest/dist/clappr-playback-rate-plugin.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/shaka-player@2.5.10/dist/shaka-player.compiled.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/clappr/dash-shaka-playback@latest/dist/dash-shaka-playback.external.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/cdnbye-shaka@latest"></script>
    <style>
        body {
            background-color: #000000;
        }
        #player {
            border-radius: 1rem;
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.25);
        }
    </style>
</head>
<body>
    <div id="player"></div>
    <script>
        // Use a unique key for this video to store its position
        const VIDEO_POSITION_KEY = 'familytv-playback-position';
        let player;
        // Save the current playback position when the user navigates away
        window.addEventListener('beforeunload', () => {
            if (player) {
                localStorage.setItem(VIDEO_POSITION_KEY, player.getCurrentTime());
            }
        });
        // Initialize the player and check for a saved position
        window.onload = function () {
            // Get the saved position from local storage, defaulting to 0
            const savedPosition = parseFloat(localStorage.getItem(VIDEO_POSITION_KEY) || '0');
            player = new Clappr.Player({
                source: 'https://cco-streamer1.cdn.3bbtv.com:8443/3bb/live/5/5.mpd',
                mimeType: 'application/dash+xml',
                height: '100%',
                width: '100%',
                autoPlay: true,
                plugins: [LevelSelector, DashShakaPlayback, Clappr.MediaControl],
                events: {
                    onReady: function () {
                        // Disable the click-to-pause plugin
                        const plugin = this.getPlugin('click_to_pause');
                        if (plugin) {
                            plugin.disable();
                        }
                        // If a saved position exists, seek to it
                        if (savedPosition > 0) {
                            console.log('Resuming playback from', savedPosition, 'seconds');
                            this.seek(savedPosition);
                        }
                    },
                    onEnded: function() {
                        // Clear the saved position when the video finishes
                        localStorage.removeItem(VIDEO_POSITION_KEY);
                    }
                },
                chromecast: {
                    preload: 'metadata',
                    contentType: 'video/mpd',
                },
                shakaConfiguration: {
                    drm: {
                        clearKeys: {
                            '87db4361f7894655a4656e9c8b935a02': 'b025a4b950df41158a87cfc8d6f2ac34'
                        }
                    },
                },
                shakaOnBeforeLoad: function (shaka_player) {},
                parentId: '#player'
            });
        };
    </script>
    <span style='position:absolute;bottom:10px;right:20px;font-size: 15px; font-weight: bold;color: #3b82f6;'>
        <em>แฟมิลี่ทีวี</em>
    </span>
</body>
</html>
