<html>
<head>
    <title>WANDERING OLDMAN AIS</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no">
    <!-- Note: The original CSS link to /clap.css is not a standard CDN and may not function.
         All necessary styles are now included inline. -->
    <script src="//cdn.jsdelivr.net/npm/@clappr/player@0.4.0/dist/clappr.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/mux.js@5.6.7/dist/mux.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/level-selector@latest/dist/level-selector.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/clappr-chromecast-plugin@latest/dist/clappr-chromecast-plugin.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/clappr-pip@latest/dist/clappr-pip.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/clappr-playback-rate-plugin@latest/dist/clappr-playback-rate-plugin.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/shaka-player@2.5.10/dist/shaka-player.compiled.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/clappr/dash-shaka-playback@latest/dist/dash-shaka-playback.external.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/cdnbye-shaka@latest"></script>
    <style>
        body {
            background-color: #000000;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #player {
            border-radius: 1rem;
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.25);
            width: 100vw;
            height: 100vh;
        }
        
        /* Custom Clappr Skin Styles */
        .clappr-player-skin {
            color: #fff;
        }
        
        .clappr-core-media-control-panel {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-top: none;
            height: 50px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .clappr-core-media-control-panel:hover {
            height: 60px;
        }
        
        .clappr-core-media-control-panel .clappr-core-media-control-button {
            background: transparent;
            border: none;
            color: #f0f0f0;
            transition: all 0.2s ease;
            font-size: 20px;
            cursor: pointer;
            padding: 0 8px;
        }

        /* Hover effect for buttons */
        .clappr-core-media-control-panel .clappr-core-media-control-button:hover,
        .clappr-core-media-control-panel .clappr-core-media-control-button:hover svg {
            color: #ff9800;
            fill: #ff9800; /* Amber-like orange for hover */
            transform: scale(1.1);
        }

        /* Adjustments for the play/pause button */
        .clappr-core-media-control-panel .clappr-core-media-control-icon-play,
        .clappr-core-media-control-panel .clappr-core-media-control-icon-pause {
            order: 1;
        }

        .clappr-core-media-control-panel .clappr-core-media-control-playback-rate-plugin {
            order: 2;
        }
        
        .clappr-core-media-control-panel .clappr-core-media-control-time-container {
            order: 3;
            font-size: 14px;
            color: #ddd;
            padding: 0 8px;
        }

        .clappr-core-media-control-panel .clappr-core-media-control-seek-bar-container {
            order: 4;
            flex-grow: 1;
            height: 5px;
            margin: 0 10px;
            cursor: pointer;
            border-radius: 2.5px;
            background-color: rgba(255, 255, 255, 0.2);
            position: relative;
        }
        
        .clappr-core-media-control-panel .clappr-core-media-control-seek-bar-fill {
            background-color: #ff9800;
            border-radius: 2.5px;
            transition: width 0.1s linear;
        }

        .clappr-core-media-control-panel .clappr-core-media-control-volume-bar-container {
            order: 5;
            height: 5px;
            cursor: pointer;
            border-radius: 2.5px;
            background-color: rgba(255, 255, 255, 0.2);
            width: 80px; /* Adjust volume bar width */
            margin-right: 10px;
        }
        
        .clappr-core-media-control-panel .clappr-core-media-control-volume-bar-fill {
            background-color: #ff9800;
            border-radius: 2.5px;
            transition: width 0.1s linear;
        }

        .clappr-core-media-control-panel .clappr-core-media-control-fullscreen-button {
            order: 6;
        }
        .clappr-core-media-control-panel .clappr-core-media-control-settings-button {
            order: 7;
        }
        .clappr-core-media-control-panel .clappr-core-media-control-volume-bar-icon {
            order: 4;
        }

    </style>
</head>
<body>
    <div id="player"></div>
    <script>
        // Use a unique key for this video to store its position
        const VIDEO_POSITION_KEY = 'familytv-playback-position';
        let player;
        // Save the current playback position when the user navigates away
        window.addEventListener('beforeunload', () => {
            if (player) {
                localStorage.setItem(VIDEO_POSITION_KEY, player.getCurrentTime());
            }
        });
        // Initialize the player and check for a saved position
        window.onload = function () {
            // Get the saved position from local storage, defaulting to 0
            const savedPosition = parseFloat(localStorage.getItem(VIDEO_POSITION_KEY) || '0');
            player = new Clappr.Player({
                source: 'https://cco-streamer1.cdn.3bbtv.com:8443/3bb/live/5/5.mpd',
                mimeType: 'application/dash+xml',
                height: '100%',
                width: '100%',
                autoPlay: true,
                plugins: [LevelSelector, DashShakaPlayback, Clappr.MediaControl],
                events: {
                    onReady: function () {
                        // Disable the click-to-pause plugin
                        const plugin = this.getPlugin('click_to_pause');
                        if (plugin) {
                            plugin.disable();
                        }
                        // If a saved position exists, seek to it
                        if (savedPosition > 0) {
                            console.log('Resuming playback from', savedPosition, 'seconds');
                            this.seek(savedPosition);
                        }
                    },
                    onEnded: function() {
                        // Clear the saved position when the video finishes
                        localStorage.removeItem(VIDEO_POSITION_KEY);
                    }
                },
                chromecast: {
                    preload: 'metadata',
                    contentType: 'video/mpd',
                },
                shakaConfiguration: {
                    drm: {
                        clearKeys: {
                            '87db4361f7894655a4656e9c8b935a02': 'b025a4b950df41158a87cfc8d6f2ac34'
                        }
                    },
                },
                shakaOnBeforeLoad: function (shaka_player) {},
                parentId: '#player'
            });
        };
    </script>
</body>
</html>
